<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GACORBOYY ADMIN - V.106 POWER</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #06090c; --side: #0e1217; --card: #161b22; --gold: #ffb300; --win: #00e676; --loss: #ff1744; --blue: #3b82f6; --text: #e1e1e1; }
        * { box-sizing: border-box; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* SIDEBAR DENGAN FIXED RESIZER */
        .sidebar { width: 180px; min-width: 60px; max-width: 80vw; background: var(--side); display: flex; flex-direction: column; height: 100%; flex-shrink: 0; border-right: 1px solid #222; position: relative; }
        .resizer { width: 15px; cursor: col-resize; position: absolute; right: -7px; top: 0; bottom: 0; z-index: 100; background: transparent; touch-action: none; }
        .resizer:active { border-right: 3px solid var(--gold); }

        .nav-item { padding: 15px; cursor: pointer; color: #888; font-weight: 600; font-size: 12px; border-left: 3px solid transparent; }
        .nav-active { background: #1c222d; color: var(--gold); border-left: 3px solid var(--gold); }
        
        .main-content { flex: 1; overflow-y: auto; padding: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 15px; border: 1px solid #333; margin-bottom: 20px; }
        
        /* TABEL PEMAIN RAPI */
        table { width: 100%; border-collapse: collapse; background: var(--card); font-size: 11px; table-layout: fixed; }
        th, td { padding: 12px 8px; text-align: left; border-bottom: 1px solid #222; word-wrap: break-word; }
        th { background: #000; color: var(--gold); text-transform: uppercase; }
        
        .btn { padding: 8px; border-radius: 6px; border: none; font-weight: 800; cursor: pointer; font-size: 9px; margin-right: 2px; color: #000; }
        #log-modal { display:none; position:fixed; inset:10px; background:rgba(0,0,0,0.98); border: 2px solid var(--gold); border-radius: 20px; z-index: 10001; padding:15px; overflow-y:auto; }
        #login-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .section { display: none; } .active-sec { display: block; }
    </style>
</head>
<body>
    <div id="login-overlay"><div class="card" style="text-align:center;"><h2 style="color:var(--gold); font-style:italic;">G-777 ADMIN</h2><input type="password" id="adm-pass" placeholder="Password Admin" style="width:100%; padding:12px; margin-bottom:15px; background:#000; color:#fff; border:1px solid #333; border-radius:8px; text-align:center;"><button onclick="unlock()" class="btn" style="background:var(--gold); width:100%; padding:15px; font-size:14px;">LOG IN</button></div></div>
    
    <div id="log-modal">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 id="log-user" style="color:var(--gold); margin:0;">RIWAYAT USER</h3>
            <button onclick="document.getElementById('log-modal').style.display='none'" class="btn" style="background:var(--loss); color:#fff; padding:5px 15px;">TUTUP</button>
        </div>
        <table><thead><tr><th style="width:40%">JAM</th><th style="width:30%">TIPE</th><th style="width:30%">RP</th></tr></thead><tbody id="log-list"></tbody></table>
    </div>

    <div class="sidebar" id="sidebar">
        <div style="padding:20px; font-weight:900; color:var(--gold); font-style:italic; text-align:center;">G-777 ADMIN</div>
        <div class="nav-item nav-active" onclick="showSec('dash', this)">üè† DASHBOARD</div>
        <div class="nav-item" onclick="showSec('players', this)">üë• PEMAIN</div>
        <div class="nav-item" onclick="showSec('reqs', this)">‚è≥ REQUEST</div>
        <div class="nav-item" onclick="showSec('settings', this)">‚öôÔ∏è SETTING</div>
        <div class="resizer" id="resizer"></div>
    </div>

    <div class="main-content">
        <div id="sec-dash" class="section active-sec">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div class="card">Profit Recap<h3 id="st-profit" style="color:var(--win); margin:5px 0;">Rp 0</h3></div>
                <div class="card">Total Player<h3 id="st-players" style="margin:5px 0;">0</h3></div>
            </div>
        </div>

        <div id="sec-players" class="section">
            <h2 style="font-size:16px;">Manajemen Pemain</h2>
            <table>
                <thead><tr><th style="width:30%">USER</th><th style="width:15%">NASIB</th><th style="width:55%">AKSI</th></tr></thead>
                <tbody id="p-list"></tbody>
            </table>
        </div>

        <div id="sec-reqs" class="section">
            <h2>Pending Requests</h2>
            <table><thead><tr><th>USER</th><th>TIPE</th><th>RP</th><th>AKSI</th></tr></thead><tbody id="r-list"></tbody></table>
        </div>

        <div id="sec-settings" class="section">
            <h2>Global Settings</h2>
            <div class="card">
                <label style="font-size:10px;">DANA ADMIN:</label><input type="text" id="set-dana" style="width:100%; padding:12px; background:#000; color:#fff; border:1px solid #333; border-radius:10px; margin-bottom:15px;">
                <label style="font-size:10px;">RUNNING TEXT:</label><input type="text" id="set-ticker" style="width:100%; padding:12px; background:#000; color:#fff; border:1px solid #333; border-radius:10px; margin-bottom:15px;">
                <button onclick="saveSettings()" class="btn" style="background:var(--win); width:100%; padding:15px; margin-top:10px;">SAVE & SYNC</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script>
        const config = { apiKey: "AIzaSyBO9wgYm6lIz9YzO8OpyuSJLqLvnI_XZVE", databaseURL: "https://gacorboy7777-default-rtdb.asia-southeast1.firebasedatabase.app" };
        firebase.initializeApp(config); const fb = firebase.database();
        let pData = [];

        /* FIX RESIZER: GESER SIDEBAR PAKE JEMPOL */
        const sidebar = document.getElementById("sidebar"), resizer = document.getElementById("resizer");
        const startResize = (e) => {
            const moveHandler = (moveEv) => {
                let x = moveEv.touches ? moveEv.touches[0].clientX : moveEv.clientX;
                if(x > 60 && x < window.innerWidth * 0.8) sidebar.style.width = x + 'px';
            };
            const stopHandler = () => {
                window.removeEventListener("mousemove", moveHandler);
                window.removeEventListener("touchmove", moveHandler);
            };
            window.addEventListener("mousemove", moveHandler);
            window.addEventListener("touchmove", moveHandler);
            window.addEventListener("mouseup", stopHandler);
            window.addEventListener("touchend", stopHandler);
        };
        resizer.addEventListener("mousedown", startResize);
        resizer.addEventListener("touchstart", startResize);

        function unlock() { if(document.getElementById('adm-pass').value==='kairi777'){document.getElementById('login-overlay').style.display='none'; init();} else alert('Salah!'); }
        function showSec(id, el) { document.querySelectorAll('.section').forEach(s=>s.classList.remove('active-sec')); document.getElementById('sec-'+id).classList.add('active-sec'); document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('nav-active')); el.classList.add('nav-active'); }

        function init() {
            fb.ref('reqs').on('value', s => {
                let p = 0, rH = ''; s.forEach(c => { 
                    const r = c.val(); if(r.s==='done'){ if(r.t==='depo') p += Number(r.a); else p -= Number(r.a); }
                    if(r.s==='pending') rH += `<tr><td>${r.u}</td><td>${r.t.toUpperCase()}</td><td>${Number(r.a).toLocaleString()}</td><td><button class="btn" style="background:var(--win)" onclick="acc('${c.key}')">OK</button></td></tr>`;
                });
                document.getElementById('st-profit').innerText = "Rp " + p.toLocaleString();
                document.getElementById('r-list').innerHTML = rH;
            });

            fb.ref('players').on('value', s => {
                let pL = '', count = 0; pData = [];
                s.forEach(c => { 
                    const d = c.val(); count++; pData.push(d);
                    /* NASIB BUTTON: W -> L -> N */
                    let nLabel = d.r === 'win' ? 'W' : (d.r === 'loss' ? 'L' : 'N');
                    pL += `<tr>
                        <td><b>${d.u}</b><br>Rp ${Number(d.bal).toLocaleString()}</td>
                        <td><button class="btn" style="background:#444; color:#fff; width:30px;" onclick="setNasib('${d.u}','${d.r}')">${nLabel}</button></td>
                        <td>
                            <button class="btn" style="background:var(--gold)" onclick="showLogs('${d.u}')">LOG</button>
                            <button class="btn" style="background:var(--blue); color:#fff" onclick="suntik('${d.u}')">üíâ</button>
                            <button class="btn" style="background:${d.status==='ban'?'var(--win)':'var(--loss)'}" onclick="ban('${d.u}','${d.status}')">X</button>
                        </td>
                    </tr>`;
                });
                document.getElementById('st-players').innerText = count;
                document.getElementById('p-list').innerHTML = pL;
            });
            fb.ref('settings').once('value', s => { const d = s.val(); if(d) { document.getElementById('set-dana').value = d.dana; document.getElementById('set-ticker').value = d.ticker; } });
        }

        function setNasib(u, r) { 
            let next = r === 'win' ? 'loss' : (r === 'loss' ? 'normal' : 'win'); 
            fb.ref('players/'+u).update({r:next}); 
        }
        function showLogs(u) { document.getElementById('log-modal').style.display = 'block'; fb.ref('logs/'+u).limitToLast(20).on('value', s => { let h = ''; s.forEach(c=>{ let l=c.val(); h += `<tr><td>${new Date(l.time).toLocaleTimeString()}</td><td>${l.t}</td><td>${Number(l.a).toLocaleString()}</td></tr>`; }); document.getElementById('log-list').innerHTML=h; }); }
        function saveSettings() { fb.ref('settings').update({ dana: document.getElementById('set-dana').value, ticker: document.getElementById('set-ticker').value }); alert('Sinkron Berhasil!'); }
        function ban(u, s) { fb.ref('players/'+u).update({status: s==='ban'?'active':'ban'}); }
        function suntik(u) { let a = parseInt(prompt('Nominal Suntik (+/-):')); if(a) fb.ref('players/'+u).get().then(s=>fb.ref('players/'+u).update({bal:Number(s.val().bal)+a})); }
        function acc(k) { fb.ref('reqs/'+k).get().then(s=>{ const r=s.val(); fb.ref('players/'+r.u).get().then(pS=>{ let nb = r.t==='depo'?Number(pS.val().bal)+Number(r.a) : Number(pS.val().bal)-Number(r.a); fb.ref('players/'+r.u).update({bal:nb}); fb.ref('reqs/'+k).update({s:'done'}); })}); }
    </script>
</body>
</html>
